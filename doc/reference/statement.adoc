== `sqlite/statement.hpp`

=== `param_ref`

A reference to a value to temporary bind for an execute statement. Most values are captures by reference.

[source,cpp]
----
struct param_ref
{
    // Default construct a parameter, gives `null`.
    param_ref() = default;
    // Bind null
    param_ref(variant2::monostate);
    // Bind null
    param_ref(std::nullptr_t);
    // Bind an integer.
    template<typename I>
    param_ref(I value);
    // Bind a blob.
    param_ref(blob_view blob);
    // Bind a string.
    param_ref(string_view text);

    template<typename StringLike>
    param_ref(StringLike && text);
    template<typename BlobLike>
    param_ref(BlobLike && text);

    // Bind a floating point value.
    param_ref(double value) : impl_(value) { }
    // Bind a zero_blob value, i.e. a blob that initialized by zero.
    param_ref(zero_blob zb) : impl_(zb) { }

    // Bind pointer value to the parameter. @see https://www.sqlite.org/bindptr.html
    // Requires sqlite 3.20
    // Deleter must a function pointer or trivially constructible.
    template<typename T, typename Deleter>
    param_ref(std::unique_ptr<T, Deleter> ptr);



    // Apply the param_ref to a statement.
    int apply(sqlite3_stmt * stmt, int c) const;

    // Construct param_ref from a variant
    template<typename T>
    param_ref(T && t);

----


=== `statement`

A statement used for a prepared-statement.



[source,cpp]
----
struct statement
{
    // check if the whole statement has been completed.
    bool done() const;

    // Execute one step of the statement. Returns false when done.
    bool step();
    bool step(system::error_code& ec, error_info& ei);

    // bind a set of parameters
    template <typename ArgRange = std::initializer_list<param_ref>>
    void bind(ArgRange && params, system::error_code& ec, error_info& info); // <1>
    template <typename ArgRange = std::initializer_list<param_ref>
    void bind(ArgRange && params); // <1>
    void bind(
        std::initializer_list<std::pair<string_view, param_ref>> params,
        system::error_code& ec,
        error_info& info); // <2>
    void bind(std::initializer_list<std::pair<string_view, param_ref>> params) ;


    // Bind a single positional parameter
    void bind(std::size_t idx, param_ref param);
    void bind(std::size_t idx, param_ref param, system::error_code& ec, error_info& info);


    // Bind a single named parameter
    void bind(string_view name, param_ref param);
    void bind(string_view name, param_ref param, system::error_code& ec, error_info& info);



    // bind a set of parameters and call step once
    template <typename ArgRange = std::initializer_list<param_ref>>
    void execute(ArgRange && params, system::error_code& ec, error_info& info); // <1>
    template <typename ArgRange = std::initializer_list<param_ref>
    void execute(ArgRange && params); // <1>
    void execute(
        std::initializer_list<std::pair<string_view, param_ref>> params,
        system::error_code& ec,
        error_info& info); // <2>
    void execute(std::initializer_list<std::pair<string_view, param_ref>> params) ;



    // Returns the sql used to construct the prepared statement.
    stringe_view sql();

    // Returns the expanded sql used to construct the prepared statement. Requires sqlite 3.14
    stringe_view expanded_sql();

    // Returns the expanded sql used to construct the prepared statement. requiers sqlite to be compiles with SQLITE_ENABLE_NORMALIZE.
    stringe_view normalized_sql();

    // Returns the declared type of the column
    string_view declared_type(int id) const;


    // The number of colums in the statement
    std::size_t column_count() const;
    // Returns the name of the column idx.
    string_view column_name(std::size_t idx) const;
    // Returns the name of the source table for column idx.
    string_view table_name(std::size_t idx) const;
    // Returns the origin name of the column for column idx.
    string_view column_origin_name(std::size_t idx) const;

    /// Clear previous bindings
    void clear_bindings(system::error_code & ec, error_info & ei);
    void clear_bindings();

    /// Reset the current execution.
    void reset(system::error_code & ec, error_info & ei);
    void reset();

    row current() const;
};
----
<1> Binds positional arguments
<2> Binds named arguments (from a map-like object)





